function showZone(){$("#large_scene_image").imgAreaSelect({show:!0})}function hideAutocompleteBox(){$(".ajax_choose_product").fadeOut("fast").find(".product_autocomplete_input").val("")}function onSelectEnd(e,t){showAutocompleteBox((selectionCurrent=t).x1,t.y1,t.height,t.width)}function undoEdit(){$("#large_scene_image").imgAreaSelect({hide:!0}),$(document).unbind("keydown")}function handlePressedKey(t,n){$(document).keyup(function(e){e.keyCode==t&&n()})}function showAutocompleteBox(e,t,n,a){$("input[name='x_axis']").val(e),$("input[name='y_axis']").val(t),$("input[name='zone_width']").val(a),$("input[name='zone_height']").val(n),handlePressedKey("27",undoEdit),type=$("#type").val(),!dragndrop||17!=type&&22!=type&&24!=type||addZone(++zoneCurrent,e,t,a,n)}function deleteProduct(e){return $("#visual_zone_"+e).fadeOut("fast",function(){$(this).remove()}),!1}function afterTextInserted(e,t,n){if(null==t||"[]"==t[0])return!1;valInput=$(this).parent().parent().parent().parent().find(".product-result"),prodList=$(this).parent().parent().parent().parent().find(".prodlist"),null!=lastEditedItem&&lastEditedItem.remove(),lastEditedItem=null;var a=t[1],i=t[0];oldVal=valInput.val(),oldValArray=oldVal.split(","),console.log(oldValArray),separator=""==oldVal?"":",",newVal=valInput.hasClass("only_one")?a:oldVal+separator+a,-1==$.inArray(a,oldValArray)&&(valInput.val(newVal),newRow='<button data-id="'+a+'" class="btn btn-default prodrow" type="button"><i class="icon-remove"></i>'+i+"</button>",valInput.hasClass("only_one")?prodList.html(newRow):prodList.append(newRow),17!=parentType&&22!=parentType&&24!=parentType||$("input[name*='value_']").each(function(){""==$(this).val()&&$(this).val(i)}))}function getProdsIds(){return void 0===$("#inputAccessories").val()?"":$("#inputAccessories").val().replace(/\-/g,",")}function addZone(e,t,n,a,i){$("input[name='x_axis']").val(t),$("input[name='y_axis']").val(n),$("input[name='zone_width']").val(a),$("input[name='zone_height']").val(i),$("#large_scene_image").imgAreaSelect({hide:!0}).before('\t\t\t<div class="fixed_zone" id="visual_zone_'+e+'" style="color:black;overflow:hidden;margin-left:'+t+"px; margin-top:"+n+"px; width:"+a+"px; height :"+i+'px; background-color:white;border:1px solid black; position:absolute;">\t\t\t\t<input type="hidden" name="zones['+e+'][x1]" value="'+(t-parseInt($("#large_scene_image").css("margin-left").replace("px","")))+'"/>\t\t\t\t<input type="hidden" name="zones['+e+'][y1]" value="'+(n-parseInt($("#large_scene_image").css("margin-top").replace("px","")))+'"/>\t\t\t\t<input type="hidden" name="zones['+e+'][width]" value="'+a+'"/>\t\t\t\t<input type="hidden" name="zones['+e+'][height]" value="'+i+'"/>\t\t\t\t<p class="zone_name">Zone '+e+'</p>\t\t\t\t<a style="margin-left:'+(parseInt(a)/2-16)+"px; margin-top:"+(parseInt(i)/2-8)+'px; position:absolute;" href="#" onclick="{resetZone('+e+'); return false;}">\t\t\t\t\t<img src="../img/admin/delete.gif" alt="" />\t\t\t\t</a>\t\t\t\t<a style="margin-left:'+parseInt(a)/2+"px; margin-top:"+(parseInt(i)/2-8)+'px; position:absolute;" href="#" onclick="{editThisZone(this); return false;}">\t\t\t\t\t\t\t\t\t</a>\t\t\t</div>\t\t'),$(".fixed_zone").css("opacity","0.8"),$("#save_scene").fadeIn("slow"),$(".ajax_choose_product:visible").find(".product_autocomplete_input").val("")}function resetZone(e){return $("input[name='x_axis']").val(0),$("input[name='y_axis']").val(0),$("input[name='zone_width']").val(0),$("input[name='zone_height']").val(0),$("#visual_zone_"+e).fadeOut("fast",function(){$(this).remove()}),!1}function getTargets(){tChild=0<$("#target_child").length?$("#target_child").val():target_child,$("#target_zoning").remove(),$.ajax({type:"POST",url:"../modules/ndk_advanced_custom_fields/admin_ajax.php",data:{getTargetChild:1,id_target:$("#target").val(),target_child:tChild,svg_path:svgPath},success:function(e){$("#target").after(e),initAreaSelect()}})}function initAreaSelect(){if(0<$("#large_scene_image").length){$("#large_scene_image > svg > path").each(function(){$("#svg_path").append('<option value="'+$(this).attr("id")+'">'+$(this).attr("id")+"</option>")}),setTimeout(function(){$("#svg_path").val($("#svg_path").attr("data-value")).trigger("change")},1e3),$("#large_scene_image").imgAreaSelect({borderWidth:1,onSelectEnd:onSelectEnd,onSelectStart:showZone,minHeight:30,minWidth:30}),zoneCurrent=startingData.length;for(var e=0;e<startingData.length;e++)addZone(zoneCurrent,startingData[e][2]+parseInt($("#large_scene_image").css("margin-left").replace("px","")),startingData[e][3]+parseInt($("#large_scene_image").css("margin-top").replace("px","")),startingData[e][4],startingData[e][5],startingData[e][1],startingData[e][0])}}function setTypesFields(e){console.log(e),$(".hidden-field").parent().parent().hide(),$(".visible-field").parent().parent().show(),$("span.visible-field").parent().parent().parent().show(),$("span.hidden-field").parent().parent().parent().hide(),$(".hidden-"+e).parent().parent().hide(),$("span.hidden-"+e).parent().parent().parent().hide(),$(".visible-"+e).parent().parent().show(),$("span.visible-"+e).parent().parent().parent().show(),$(".hidden-note").hide(),$(".visible-note").parent().show(),$(".hidden-note-"+e).hide(),$(".visible-note-"+e).show()}zoneCurrent=0,valueOfZoneEdited=selectionCurrent=null,dragndrop=!1,lastEditedItem=null,$(document).ready(function(){$("#fonts, #sizes, #colors").addClass("hidden-field visible-0"),$("#nb_lines").parent().parent().hide(),"undefined"!=typeof parentType&&setTypesFields(parentType),$("#target").change(function(){getTargets()}),$("#target").trigger("change"),$("#type").change(function(){setTypesFields($(this).val()),0==$(this).val()?$("#nb_lines").parent().parent().show():$("#nb_lines").parent().parent().hide()}),$("#type").trigger("change"),$("input.product-result").hide(),$(".setAdminName").trigger("keyup"),"undefined"!=typeof tryThisFilter&&(tryThisFilterBlock='<span class="filter_attention">'+tryThisFilter+"</span>",$("[name='ndk_customization_fieldFilter_p!id_product']").after(tryThisFilterBlock)),$(".categoryprodcheckbox").change(function(){$(this).is(":checked")?($(this).parent().parent().find(".prodcheckbox").prop("checked",!0),$(this).parent().parent().find(".tree-item-name").addClass("tree-selected")):($(this).parent().parent().find(".prodcheckbox").prop("checked",!1),$(this).parent().parent().find(".tree-selected").removeClass("tree-selected"))})}),$(document).on("change","#svg_path",function(e){""!=$(this).val&&$("path#"+$(this).val()).css("stroke","blue")}),$(document).on("click",".prodrow",function(){idProduct=$(this).attr("data-id"),oldVal=$(this).parent().parent().find(".product-result").val(),(oldValArray=oldVal.split(",")).splice($.inArray(idProduct,oldValArray),1),newVal="",console.log(oldValArray);for(var e=0;e<oldValArray.length;e++)void 0!==oldValArray[e]&&(newVal+=oldValArray[e]+(e<oldValArray.length-1?",":""));$(this).parent().parent().find(".product-result").val(newVal),$(this).remove()}),$(window).on("load",function(){$(".editable-value").attr("onclick",""),$(".product_autocomplete_input").autocomplete("ajax_products_list.php?exclude_packs=false&excludeVirtuals=false&token="+tokenproduct,{minChars:1,autoFill:!0,max:20,matchContains:!0,mustMatch:!0,scroll:!1,extraParams:{excludeIds:"9999999"}}).result(afterTextInserted),initAreaSelect()});var typingTimer,doneTypingInterval=2e3;function saveSpecificPrice(t){myDatas=t.parent().find("input, select").serialize(),$.ajax({type:"POST",url:"../modules/ndk_advanced_custom_fields/admin_ajax.php?action=saveSpecificPrice",data:myDatas,success:function(e){t.parent().find("input.id_specific_price").val(e),t.parent().append('<div id="saved">OK</div>'),setTimeout(function(){$("#saved").remove()},2e3)}})}function deleteSpecificPrice(t){myDatas=t.parent().find("input, select").serialize(),$.ajax({type:"POST",url:"../modules/ndk_advanced_custom_fields/admin_ajax.php?action=deleteSpecificPrice",data:myDatas,success:function(e){t.parent().remove()}})}$(document).on("keyup",".setAdminName",function(){newVal=$(this).val(),clearTimeout(typingTimer),typingTimer=setTimeout(function(){$(".adminName").each(function(){""==$(this).val()&&$(this).val(newVal)})},doneTypingInterval)}),$(document).on("click","td.editable-value",function(e){e.preventDefault(),$(this).attr("contenteditable","true").addClass("editableDom").focus()}),$(document).on("blur","td.editable-value.editableDom",function(e){e.preventDefault(),el=$(this),id_ndk_customization_field=$(this).parent().attr("id").split("_")[2],$(this).hasClass("set_positionndk_customization_field")?action="set_positionndk_customization_field":$(this).hasClass("set_zindexndk_customization_field")?action="set_zindexndk_customization_field":$(this).hasClass("set_ref_positionndk_customization_field")&&(action="set_ref_positionndk_customization_field"),position=parseFloat($(this).text()),url=currentIndex+"&token="+token+"&id_ndk_customization_field="+id_ndk_customization_field+"&"+action+"="+position,$.ajax({type:"GET",url:url,success:function(e){el.attr("contenteditable","false").removeClass("editableDom")}})}),$(document).on("click",".submitSpecificPrice",function(e){e.preventDefault(),saveSpecificPrice($(this))}),$(document).on("click",".removeSpecificPrice",function(e){e.preventDefault(),deleteSpecificPrice($(this))}),$(document).on("click",".addSpecificPrice",function(){cloned=$(".specificPriceBlock_matrix").clone(),topaste='<div class="clear clearfix specificPriceBlock">'+cloned.html()+"</div>",$(".specificPriceBlock_matrix").after(topaste)}),$(document).on("click",".AjaxremoveFile",function(){parentBlock=$(this).parent(),$.ajax({type:"POST",url:"../modules/ndk_advanced_custom_fields/admin_ajax.php?action=deleteFile",data:{file:$(this).attr("data-file")},success:function(){parentBlock.fadeOut()}})}),$(document).on("change",".prodcheckbox",function(){me=$(this),sames=$(".prodcheckbox[value="+me.val()+"]").not(me),me.is(":checked")?sames.each(function(){$(this).prop("checked",!0).parent().addClass("tree-selected")}):sames.each(function(){$(this).prop("checked",!1).parent().removeClass("tree-selected")})}),$(document).on("keyup","#quantity_min",function(){$("#weight_min, #weight_max").val(0)}),$(document).on("keyup","#quantity_max",function(){$("#weight_min, #weight_max").val(0)}),$(document).on("keyup","#weight_min",function(){$("#quantity_min, #quantity_max").val(0)}),$(document).on("keyup","#weight_max",function(){$("#quantity_min, #quantity_max").val(0)});