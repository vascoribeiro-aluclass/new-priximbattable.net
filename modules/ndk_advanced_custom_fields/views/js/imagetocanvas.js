var imageData,data,imageData1,data1,canvas=document.getElementById("maskcanvas"),ctx=canvas.getContext("2d"),canvases=[],strokeWeight=8,defineNonTransparent=function(a,e){return 0<data1[4*(e*cw+a)+3]},img=new Image;function start(){for(canvas.width=cw=img.width,canvas.height=ch=img.height,ctx.drawImage(img,0,0);moveDiscreteElementToNewCanvas(););for(var a=0;a<canvases.length;a++)addStickerEffect(canvases[a],strokeWeight),ctx.drawImage(canvases[a],0,0);ctx.drawImage(img,0,0)}function addStickerEffect(a,e){var t=a.toDataURL(),n=a.getContext("2d"),a=a.outlinePoints,i=(addStickerLayer(n,a,e),new Image);i.onload=function(){n.drawImage(i,0,0)},i.src=t}function addStickerLayer(a,e,t){imageData=a.getImageData(0,0,canvas.width,canvas.height),data1=imageData.data,defineGeomPath(a,geom.contour(defineNonTransparent)),a.lineJoin="round",a.lineCap="round",a.strokeStyle="white",a.lineWidth=t,a.stroke()}function moveDiscreteElementToNewCanvas(){imageData=ctx.getImageData(0,0,canvas.width,canvas.height),data1=imageData.data;for(var a,e,t,n=!1,i=0;i<data1.length;i+=4)if(0<data1[i+3]){n=!0;break}if(n)return a=geom.contour(defineNonTransparent),(e=document.createElement("canvas")).width=canvas.width,e.height=canvas.height,document.body.appendChild(e),canvases.push(e),defineGeomPath(t=e.getContext("2d"),e.outlinePoints=a),t.save(),t.clip(),t.drawImage(canvas,0,0),t.restore(),defineGeomPath(ctx,a),ctx.save(),ctx.clip(),ctx.globalCompositeOperation="destination-out",ctx.clearRect(0,0,canvas.width,canvas.height),ctx.restore(),!0}function defineGeomPath(a,e){a.beginPath(),a.moveTo(e[0][0],e[0][1]);for(var t=1;t<e.length;t++)a.lineTo(e[t][0],e[t][1]);a.lineTo(e[0][0],e[0][1]),a.closePath()}img.crossOrigin="anonymous",img.onload=start,img.src="https://dl.dropboxusercontent.com/u/139992952/multple/makeIndividual.png",function(){(geom={}).contour=function(a,e){for(var t=e||function(a){var e=0,t=0;for(;;){if(a(e,t))return[e,t];0===e?(e=t+1,t=0):(e-=1,t+=1)}}(a),n=[],i=t[0],o=t[1],c=0,r=0,s=NaN,d=NaN,g=0;g=0,a(i-1,o-1)&&(g+=1),a(i,o-1)&&(g+=2),a(i-1,o)&&(g+=4),a(i,o)&&(g+=8),r=6===g?(c=-1===d?-1:1,0):9===g?(c=0,1===s?-1:1):(c=m[g],h[g]),c!=s&&r!=d&&(n.push([i,o]),s=c,d=r),o+=r,t[0]!=(i+=c)||t[1]!=o;);return n};var m=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],h=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN]}();